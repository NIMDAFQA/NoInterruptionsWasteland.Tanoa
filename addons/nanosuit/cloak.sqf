// ******************************************************************************************
// *This project is licensed under the GNU Affero GPL v3. Copyright Â© 2015 Poisonous Shadows*
// ******************************************************************************************
//  @file Name: cloak.sqf
//  @file Author: NIMDA

////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                Setup
////////////////////////////////////////////////////////////////////////////////////////////////////////////
_player = _this select 0;
_toggle = _this select 1;
_powerRemaining = _this select 2;
_timer = 240;
_cooldown = 30;
////////////////////////////////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////////////////////////////////
//												Toggle On
////////////////////////////////////////////////////////////////////////////////////////////////////////////
if(_toggle) then
{
////////////////////////////////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                           Wavy Particle Effect
////////////////////////////////////////////////////////////////////////////////////////////////////////////
	/*source = "#particlesource" createVehiclelocal getpos _player;
	source setParticleCircle [0, [0.1, 0.1, 0.1]];
	source setParticleRandom [0, [0, 0.1, 1], [0.1, 0, 0.1], 0, 0.1, [0, 0, 0, 0.1], 0, 0];
	source setParticleParams [["\A3\data_f\ParticleEffects\Universal\Refract", 1, 0, 1], "", "Billboard", 1, 4, [0, 0, 0], [0, 0, 0.5], 9, 10, 7.9, 0.1, [0.6, 1, 0.9, 0.8], [[0.1, 0.1, 0.1, 1], [0.25, 0.25, 0.25, 0.5], [0.5, 0.5, 0.5, 0]], [0, 0.1, 0.2, 0.5, 0.1, 0.1], 0, 0, "", "", _player];
	source setDropInterval 0.1;
	source attachto [_player,[0,0,0]];*/
	[_player] spawn {(_this select 0) hideObjectGlobal true;};
	_player setCaptive true;
////////////////////////////////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                           Timer/Cooldown Mgmt
////////////////////////////////////////////////////////////////////////////////////////////////////////////
	//[[[_timer,_toggle,_cooldown],"addons\nanosuit\cloak_cli.sqf"],"BIS_fnc_execVM",_player] call BIS_fnc_MP;
	_timeLeft = _timer * _powerRemaining;
	while {!(_timeLeft < 0)} do
	{
	    _timeLeft = _timeLeft -1;
	    sleep 1;
	};
	
	//deleteVehicle source;
	sleep 1;
	_player hideObjectGlobal false;
	_player setCaptive false;

	//[[[_timer,false,_cooldown],"addons\nanosuit\cloak_cli.sqf"],"BIS_fnc_execVM",_player] call BIS_fnc_MP;
////////////////////////////////////////////////////////////////////////////////////////////////////////////
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////
//											Toggle Off
////////////////////////////////////////////////////////////////////////////////////////////////////////////
else
{
	//deleteVehicle source;
	sleep 1;
	_player hideObjectGlobal false;
	_player setCaptive false;
	//[[[_timer,_toggle,_cooldown],"addons\nanosuit\cloak_cli.sqf"],"BIS_fnc_execVM",_player] call BIS_fnc_MP;
};
////////////////////////////////////////////////////////////////////////////////////////////////////////////